[{"line":"1","token_name":"T_OPEN_TAG","text":"<?php\n"},{"line":"2","token_name":"T_DECLARE","text":"declare"},{"line":"2","token_name":"(","text":"("},{"line":"2","token_name":"T_STRING","text":"strict_types"},{"line":"2","token_name":"=","text":"="},{"line":"2","token_name":"T_LNUMBER","text":"1"},{"line":"2","token_name":")","text":")"},{"line":"2","token_name":";","text":";"},{"line":"2","token_name":"T_WHITESPACE","text":"\n"},{"line":"3","token_name":"T_COMMENT","text":"\/\/ необходимые HTTP-заголовки"},{"line":"3","token_name":"T_WHITESPACE","text":"\n"},{"line":"4","token_name":"T_STRING","text":"header"},{"line":"4","token_name":"(","text":"("},{"line":"4","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"\"Access-Control-Allow-Origin: *\""},{"line":"4","token_name":")","text":")"},{"line":"4","token_name":";","text":";"},{"line":"4","token_name":"T_WHITESPACE","text":"\n"},{"line":"5","token_name":"T_STRING","text":"header"},{"line":"5","token_name":"(","text":"("},{"line":"5","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"\"Access-Control-Allow-Headers: access\""},{"line":"5","token_name":")","text":")"},{"line":"5","token_name":";","text":";"},{"line":"5","token_name":"T_WHITESPACE","text":"\n"},{"line":"6","token_name":"T_STRING","text":"header"},{"line":"6","token_name":"(","text":"("},{"line":"6","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"\"Access-Control-Allow-Methods: GET\""},{"line":"6","token_name":")","text":")"},{"line":"6","token_name":";","text":";"},{"line":"6","token_name":"T_WHITESPACE","text":"\n"},{"line":"7","token_name":"T_STRING","text":"header"},{"line":"7","token_name":"(","text":"("},{"line":"7","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"\"Access-Control-Allow-Credentials: true\""},{"line":"7","token_name":")","text":")"},{"line":"7","token_name":";","text":";"},{"line":"7","token_name":"T_WHITESPACE","text":"\n"},{"line":"8","token_name":"T_STRING","text":"header"},{"line":"8","token_name":"(","text":"("},{"line":"8","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"\"Content-Type: application\/json\""},{"line":"8","token_name":")","text":")"},{"line":"8","token_name":";","text":";"},{"line":"8","token_name":"T_WHITESPACE","text":"\n"},{"line":"9","token_name":"T_IF","text":"if"},{"line":"9","token_name":"T_WHITESPACE","text":" "},{"line":"9","token_name":"(","text":"("},{"line":"9","token_name":"T_VARIABLE","text":"$_SERVER"},{"line":"9","token_name":"[","text":"["},{"line":"9","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"\"REQUEST_METHOD\""},{"line":"9","token_name":"]","text":"]"},{"line":"9","token_name":"T_WHITESPACE","text":" "},{"line":"9","token_name":"T_IS_NOT_IDENTICAL","text":"!=="},{"line":"9","token_name":"T_WHITESPACE","text":" "},{"line":"9","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"'GET'"},{"line":"9","token_name":")","text":")"},{"line":"9","token_name":"T_WHITESPACE","text":" "},{"line":"9","token_name":"{","text":"{"},{"line":"9","token_name":"T_WHITESPACE","text":"\n    "},{"line":"10","token_name":"T_STRING","text":"header"},{"line":"10","token_name":"(","text":"("},{"line":"10","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"'HTTP\/1.0 403 Forbidden'"},{"line":"10","token_name":")","text":")"},{"line":"10","token_name":";","text":";"},{"line":"10","token_name":"T_WHITESPACE","text":"\n    "},{"line":"11","token_name":"T_STRING","text":"http_response_code"},{"line":"11","token_name":"(","text":"("},{"line":"11","token_name":"T_LNUMBER","text":"403"},{"line":"11","token_name":")","text":")"},{"line":"11","token_name":";","text":";"},{"line":"11","token_name":"T_WHITESPACE","text":"\n    "},{"line":"12","token_name":"T_ECHO","text":"echo"},{"line":"12","token_name":"T_WHITESPACE","text":" "},{"line":"12","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"'This method is not allowed!'"},{"line":"12","token_name":";","text":";"},{"line":"12","token_name":"T_WHITESPACE","text":"\n    "},{"line":"13","token_name":"T_EXIT","text":"exit"},{"line":"13","token_name":";","text":";"},{"line":"13","token_name":"T_WHITESPACE","text":"\n"},{"line":"14","token_name":"}","text":"}"},{"line":"14","token_name":"T_WHITESPACE","text":"\n"},{"line":"15","token_name":"T_COMMENT","text":"\/\/ подключение файла для соединения с базой и файл с объектом"},{"line":"15","token_name":"T_WHITESPACE","text":"\n"},{"line":"16","token_name":"T_INCLUDE_ONCE","text":"include_once"},{"line":"16","token_name":"T_WHITESPACE","text":" "},{"line":"16","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"'..\/config\/database.php'"},{"line":"16","token_name":";","text":";"},{"line":"16","token_name":"T_WHITESPACE","text":"\n"},{"line":"17","token_name":"T_INCLUDE_ONCE","text":"include_once"},{"line":"17","token_name":"T_WHITESPACE","text":" "},{"line":"17","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"'..\/objects\/product.php'"},{"line":"17","token_name":";","text":";"},{"line":"17","token_name":"T_WHITESPACE","text":"\n\n"},{"line":"19","token_name":"T_COMMENT","text":"\/\/ получаем соединение с базой данных"},{"line":"19","token_name":"T_WHITESPACE","text":"\n"},{"line":"20","token_name":"T_VARIABLE","text":"$database"},{"line":"20","token_name":"T_WHITESPACE","text":" "},{"line":"20","token_name":"=","text":"="},{"line":"20","token_name":"T_WHITESPACE","text":" "},{"line":"20","token_name":"T_NEW","text":"new"},{"line":"20","token_name":"T_WHITESPACE","text":" "},{"line":"20","token_name":"T_STRING","text":"Database"},{"line":"20","token_name":"(","text":"("},{"line":"20","token_name":")","text":")"},{"line":"20","token_name":";","text":";"},{"line":"20","token_name":"T_WHITESPACE","text":"\n"},{"line":"21","token_name":"T_VARIABLE","text":"$db"},{"line":"21","token_name":"T_WHITESPACE","text":" "},{"line":"21","token_name":"=","text":"="},{"line":"21","token_name":"T_WHITESPACE","text":" "},{"line":"21","token_name":"T_VARIABLE","text":"$database"},{"line":"21","token_name":"T_OBJECT_OPERATOR","text":"->"},{"line":"21","token_name":"T_STRING","text":"getConnection"},{"line":"21","token_name":"(","text":"("},{"line":"21","token_name":")","text":")"},{"line":"21","token_name":";","text":";"},{"line":"21","token_name":"T_WHITESPACE","text":"\n\n"},{"line":"23","token_name":"T_DOC_COMMENT","text":"\/** @var int[] $ids_arr *\/"},{"line":"23","token_name":"T_WHITESPACE","text":"\n"},{"line":"24","token_name":"T_VARIABLE","text":"$ids_arr"},{"line":"24","token_name":"T_WHITESPACE","text":" "},{"line":"24","token_name":"=","text":"="},{"line":"24","token_name":"T_WHITESPACE","text":" "},{"line":"24","token_name":"T_STRING","text":"explode"},{"line":"24","token_name":"(","text":"("},{"line":"24","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"','"},{"line":"24","token_name":",","text":","},{"line":"24","token_name":"T_VARIABLE","text":"$_GET"},{"line":"24","token_name":"[","text":"["},{"line":"24","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"'ids'"},{"line":"24","token_name":"]","text":"]"},{"line":"24","token_name":")","text":")"},{"line":"24","token_name":"T_WHITESPACE","text":" "},{"line":"24","token_name":"T_COALESCE","text":"??"},{"line":"24","token_name":"T_WHITESPACE","text":" "},{"line":"24","token_name":"T_EXIT","text":"die"},{"line":"24","token_name":"(","text":"("},{"line":"24","token_name":")","text":")"},{"line":"24","token_name":";","text":";"},{"line":"24","token_name":"T_WHITESPACE","text":"\n"},{"line":"25","token_name":"T_VARIABLE","text":"$ids"},{"line":"25","token_name":"T_WHITESPACE","text":" "},{"line":"25","token_name":"=","text":"="},{"line":"25","token_name":"T_WHITESPACE","text":" "},{"line":"25","token_name":"T_STRING","text":"implode"},{"line":"25","token_name":"(","text":"("},{"line":"25","token_name":"T_CONSTANT_ENCAPSED_STRING","text":"','"},{"line":"25","token_name":",","text":","},{"line":"25","token_name":"T_WHITESPACE","text":" "},{"line":"25","token_name":"T_VARIABLE","text":"$ids_arr"},{"line":"25","token_name":")","text":")"},{"line":"25","token_name":";","text":";"},{"line":"25","token_name":"T_WHITESPACE","text":"\n"},{"line":"26","token_name":"T_VARIABLE","text":"$query"},{"line":"26","token_name":"T_WHITESPACE","text":" "},{"line":"26","token_name":"=","text":"="},{"line":"26","token_name":"T_WHITESPACE","text":" "},{"line":"26","token_name":"\"","text":"\""},{"line":"26","token_name":"T_ENCAPSED_AND_WHITESPACE","text":"with ids (id) as\n(\nSELECT unnest(string_to_array('"},{"line":"28","token_name":"T_VARIABLE","text":"$ids"},{"line":"28","token_name":"T_ENCAPSED_AND_WHITESPACE","text":"',',')) AS id\n)\n\nSELECT     t.price \nFROM     products as t\nINNER JOIN    ids\nON        t.ID = ids.id::int"},{"line":"34","token_name":"\"","text":"\""},{"line":"34","token_name":";","text":";"},{"line":"34","token_name":"T_WHITESPACE","text":"\n"},{"line":"35","token_name":"T_VARIABLE","text":"$stmt"},{"line":"35","token_name":"T_WHITESPACE","text":" "},{"line":"35","token_name":"=","text":"="},{"line":"35","token_name":"T_WHITESPACE","text":" "},{"line":"35","token_name":"T_VARIABLE","text":"$db"},{"line":"35","token_name":"T_OBJECT_OPERATOR","text":"->"},{"line":"35","token_name":"T_STRING","text":"prepare"},{"line":"35","token_name":"(","text":"("},{"line":"35","token_name":"T_VARIABLE","text":"$query"},{"line":"35","token_name":")","text":")"},{"line":"35","token_name":";","text":";"},{"line":"35","token_name":"T_WHITESPACE","text":"\n"},{"line":"36","token_name":"T_VARIABLE","text":"$stmt"},{"line":"36","token_name":"T_OBJECT_OPERATOR","text":"->"},{"line":"36","token_name":"T_STRING","text":"execute"},{"line":"36","token_name":"(","text":"("},{"line":"36","token_name":")","text":")"},{"line":"36","token_name":";","text":";"},{"line":"36","token_name":"T_WHITESPACE","text":"\n"},{"line":"37","token_name":"T_VARIABLE","text":"$prices"},{"line":"37","token_name":"T_WHITESPACE","text":" "},{"line":"37","token_name":"=","text":"="},{"line":"37","token_name":"T_WHITESPACE","text":" "},{"line":"37","token_name":"T_VARIABLE","text":"$stmt"},{"line":"37","token_name":"T_OBJECT_OPERATOR","text":"->"},{"line":"37","token_name":"T_STRING","text":"fetchAll"},{"line":"37","token_name":"(","text":"("},{"line":"37","token_name":"T_STRING","text":"PDO"},{"line":"37","token_name":"T_DOUBLE_COLON","text":"::"},{"line":"37","token_name":"T_STRING","text":"FETCH_COLUMN"},{"line":"37","token_name":",","text":","},{"line":"37","token_name":"T_LNUMBER","text":"0"},{"line":"37","token_name":")","text":")"},{"line":"37","token_name":";","text":";"},{"line":"37","token_name":"T_WHITESPACE","text":"\n"},{"line":"38","token_name":"T_VARIABLE","text":"$intPrices"},{"line":"38","token_name":"T_WHITESPACE","text":" "},{"line":"38","token_name":"=","text":"="},{"line":"38","token_name":"T_WHITESPACE","text":" "},{"line":"38","token_name":"T_STRING","text":"array_map"},{"line":"38","token_name":"(","text":"("},{"line":"38","token_name":"T_WHITESPACE","text":"\n    "},{"line":"39","token_name":"T_FUNCTION","text":"function"},{"line":"39","token_name":"(","text":"("},{"line":"39","token_name":"T_VARIABLE","text":"$value"},{"line":"39","token_name":")","text":")"},{"line":"39","token_name":"T_WHITESPACE","text":" "},{"line":"39","token_name":"{","text":"{"},{"line":"39","token_name":"T_WHITESPACE","text":" "},{"line":"39","token_name":"T_RETURN","text":"return"},{"line":"39","token_name":"T_WHITESPACE","text":" "},{"line":"39","token_name":"T_INT_CAST","text":"(int)"},{"line":"39","token_name":"T_VARIABLE","text":"$value"},{"line":"39","token_name":";","text":";"},{"line":"39","token_name":"T_WHITESPACE","text":" "},{"line":"39","token_name":"}","text":"}"},{"line":"39","token_name":",","text":","},{"line":"39","token_name":"T_WHITESPACE","text":"\n    "},{"line":"40","token_name":"T_VARIABLE","text":"$prices"},{"line":"40","token_name":"T_WHITESPACE","text":"\n"},{"line":"41","token_name":")","text":")"},{"line":"41","token_name":";","text":";"},{"line":"41","token_name":"T_WHITESPACE","text":"\n"},{"line":"42","token_name":"T_VARIABLE","text":"$result"},{"line":"42","token_name":"T_WHITESPACE","text":" "},{"line":"42","token_name":"=","text":"="},{"line":"42","token_name":"T_WHITESPACE","text":" "},{"line":"42","token_name":"T_STRING","text":"intval"},{"line":"42","token_name":"(","text":"("},{"line":"42","token_name":"T_STRING","text":"array_sum"},{"line":"42","token_name":"(","text":"("},{"line":"42","token_name":"T_VARIABLE","text":"$intPrices"},{"line":"42","token_name":")","text":")"},{"line":"42","token_name":")","text":")"},{"line":"42","token_name":";","text":";"},{"line":"42","token_name":"T_WHITESPACE","text":"\n"},{"line":"43","token_name":"T_STRING","text":"http_response_code"},{"line":"43","token_name":"(","text":"("},{"line":"43","token_name":"T_LNUMBER","text":"200"},{"line":"43","token_name":")","text":")"},{"line":"43","token_name":";","text":";"},{"line":"43","token_name":"T_WHITESPACE","text":"\n"},{"line":"44","token_name":"T_ECHO","text":"echo"},{"line":"44","token_name":"T_WHITESPACE","text":" "},{"line":"44","token_name":"T_VARIABLE","text":"$result"},{"line":"44","token_name":";","text":";"},{"line":"44","token_name":"T_WHITESPACE","text":"\n"}]